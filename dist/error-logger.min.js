/*! error-logger 19-09-2014 */
!function(){"use strict";function a(){a.LOCALSTORAGE_PREFIX_KEY="LOGS_TO_KEEP",a.LOCALSTORAGE_INDEX_KEY="LOGS_INDEX",this.nbChunks=10,this.linesInChunks=100}a.getInstance=function(){return a.inst||(a.inst=new a),a.inst},a.getInstance.setNbChunks=function(a){this.nbChunks=a},a.getInstance.setLinesInChunks=function(a){this.linesInChunks=a},a.prototype.handleError=function(a,b,c){try{var d=this.formatLine(a);b&&b.stack&&(d+="\n"+b.stack),c||console.error(d),this.addToCurrentChunk(d)}catch(e){console.error(e.stack)}},a.prototype.getLogs=function(){try{var b=this.getLocalStorage();if(b){for(var c=this.getIndex(),d="",e=c.firstChunk;e<=c.currentChunk;e++)d=d?d+"\n"+b.getItem(a.LOCALSTORAGE_PREFIX_KEY+e):b.getItem(a.LOCALSTORAGE_PREFIX_KEY+e);return d}return"Your browser does not support Local storage"}catch(f){console.error(f.stack)}},a.prototype.clearLogs=function(){try{var a=this.getLocalStorage();a&&a.clear()}catch(b){console.error(b.stack)}},a.prototype.getLocalStorage=function(){return"undefined"!=typeof Storage?window.localStorage:void 0},a.prototype.formatLine=function(a){var b=new Date,c=b.getFullYear()+"-"+("00"+b.getDate()).slice(-2)+"-"+("00"+(b.getMonth()+1)).slice(-2)+" "+("00"+b.getHours()).slice(-2)+":"+("00"+b.getMinutes()).slice(-2)+":"+("00"+b.getSeconds()).slice(-2);return c+" | "+a},a.prototype.createIndex=function(){return{firstChunk:0,currentChunk:0}},a.prototype.getIndex=function(){var b,c=this.getLocalStorage();if(c)try{var d=c.getItem(a.LOCALSTORAGE_INDEX_KEY);d&&(b=JSON.parse(d))}catch(e){console.log("Log index cannot be found or is corrupted")}return b||(b=this.createIndex(),this.saveIndex(b)),b},a.prototype.saveIndex=function(b){var c=this.getLocalStorage();if(c)try{c.setItem(a.LOCALSTORAGE_INDEX_KEY,JSON.stringify(b))}catch(d){console.log("Log index cannot be saved")}},a.prototype.countLines=function(a){return a?a.split("\n").length:0},a.prototype.removeOldLogs=function(b){var c=this.getLocalStorage();if(c)try{if(b.currentChunk-b.firstChunk>this.nbChunks){for(var d=b.firstChunk;d<=b.currentChunk-this.nbChunks;d++)c.removeItem(a.LOCALSTORAGE_PREFIX_KEY+d);b.firstChunk=b.currentChunk-this.nbChunks+1}}catch(e){console.log("Could not clear logs")}},a.prototype.addToCurrentChunk=function(b){var c=this.getIndex(),d=this.getLocalStorage();if(d){var e=a.LOCALSTORAGE_PREFIX_KEY+c.currentChunk,f=d.getItem(e),g=this.countLines(f);g>this.linesInChunks&&(c.currentChunk++,this.removeOldLogs(c),this.saveIndex(c),f="",e=a.LOCALSTORAGE_PREFIX_KEY+c.currentChunk),f=f?f+"\n"+b:b,d.setItem(e,f)}}}();